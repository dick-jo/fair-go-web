# Fair Go Web - Project Context

This is the **primary web application for a political party**. It serves as the main funnel for:

- **Member onboarding and management**
- **Email collection and communications**
- **Donation processing** (one-time and recurring)
- **Membership subscriptions** (paid memberships)
- **Content publishing** (news, policy positions, team bios)
- **Public-facing marketing and advocacy**

Built with SvelteKit, Supabase, and Stripe for a modern, scalable political movement platform.

---

## Tech Stack

### Core Framework

- **SvelteKit 2** with **Svelte 5** (using runes syntax)
- **TypeScript** for type safety
- **Vite** for build tooling
- **Netlify** for deployment

### Key Dependencies

- **Supabase** (`@supabase/ssr`, `@supabase/supabase-js`) - Authentication and database
- **Stripe** - Payment processing for memberships and donations
- **@humanspeak/svelte-markdown** & **marked** - Markdown rendering
- **@lucide/svelte** - Icon system
- **postgres** - Direct database access

### Development Tools

- ESLint + Prettier (with Svelte plugins)
- `svelte-check` for type checking
- TypeScript ESLint parser

---

## For New Collaborators

### Required Setup

**1. Environment Variables**
Copy `.env.example` to `.env` and fill in:

- Supabase URL and keys (from Supabase Dashboard → Settings → API)
- Stripe API keys (from Stripe Dashboard → Developers → API Keys)
- Stripe webhook secret (for local webhook testing)

See `README.md` for detailed setup instructions.

**2. Claude Code (Recommended)**
This project is optimized for AI-assisted development:

- Install Supabase CLI: `brew install supabase/tap/supabase`
- Install Netlify CLI: `brew install netlify-cli`
- Configure `.mcp.json` with your Supabase credentials
- See `docs/NEW_SESSION_INSTRUCTIONS.md` for MCP server setup

**3. Local Development**

```bash
npm install
npm run dev
```

### Documentation

- `README.md` - Full setup guide and project overview
- `docs/SECURITY_AUDIT_REPORT.md` - Security best practices
- `docs/NEW_SESSION_INSTRUCTIONS.md` - Claude Code setup guide
- `.env.example` - Required environment variables with instructions

---

## Project Structure

```
src/
├── lib/
│   ├── components/     # Reusable UI components (each in own directory)
│   ├── server/         # Server-side code
│   ├── client/         # Client-side code
│   ├── services/       # Business logic and services
│   ├── utils/          # Utility functions
│   ├── types/          # TypeScript type definitions
│   ├── config/         # Configuration files
│   ├── style/          # Global styles and design tokens
│   └── assets/         # Static assets
└── routes/
    ├── (general)/      # Public routes (marketing, content)
    ├── (private)/      # Authenticated routes (user dashboard)
    └── api/            # API endpoints
```

---

## Component Architecture

### Component Organization

- **One component per directory**: `src/lib/components/ComponentName/ComponentName.svelte`
- **PascalCase naming** for component directories and files

### Svelte 5 Patterns

- Use **runes syntax**: `$props()`, `$state()`, `$derived()`, `$effect()`
- TypeScript `Props` interface extending relevant HTML attributes
- Use `Omit<HTMLButtonAttributes, 'class'>` pattern for native element wrappers

Example component structure:

```svelte
<script lang="ts">
	import type { HTMLButtonAttributes } from 'svelte/elements'

	interface Props extends Omit<HTMLButtonAttributes, 'class'> {
		label: string
		fit?: 'intrinsic' | 'extrinsic'
	}

	let { label, fit = 'intrinsic', ...buttonProps }: Props = $props()
</script>

<button class={['host', 'button', `fit--${fit}`]} {...buttonProps}>
	{label}
</button>

<style>
	/* Component styles */
</style>
```

---

## Styling System

### CSS Architecture

- **Component-scoped styles** using Svelte's `<style>` blocks
- **Local CSS variables** with `--loc-` prefix for component-specific values
- **Global design tokens** from `src/lib/style/system.tokens.css`
- **Typography system** in `src/lib/style/typography.css`

### CSS Patterns

```css
.host.component {
	/* Define local variables first */
	--loc-height: var(--sp-6);
	--loc-gap: var(--gap-l);

	/* Modifier variations */
	&.fit--intrinsic {
		--loc-width: auto;
	}
	&.fit--extrinsic {
		--loc-width: 100%;
	}

	/* Apply variables to properties */
	width: var(--loc-width);
	height: var(--loc-height);
}
```

### Design Token Categories

- `--sp-*` - Spacing tokens
- `--gap-*` - Gap/padding tokens
- `--clr-*` - Color tokens
- `--bdr-*` - Border radius tokens
- `--bdw` - Border width
- `--font--*` - Typography tokens
- `--t-*` - Transition tokens

---

## Key Features

### Authentication & Users

- **Supabase Auth** with SSR support
- Protected routes in `(private)` group
- Auth callback handling at `/auth/callback`

### Payment Processing

- **Stripe integration** for:
  - Membership subscriptions (`/membership`)
  - One-time donations (`/donate`)
  - Success pages for both flows
- Transaction history in private dashboard

### Content Management

- **News system** with slug-based routing
- **Policy content** with nested routing
- **Team profiles** with individual pages
- Markdown rendering for content

### User Dashboard

- Private area at `/private/*`
- Membership management
- Communication preferences
- Transaction history

---

## Routing Conventions

### Route Groups

- `(general)` - Public-facing pages (no auth required)
- `(private)` - Authenticated user area (auth required)
- `api` - API endpoints

### Layout Hierarchy

- Root layout: `src/routes/+layout.svelte`
- Group layouts: `src/routes/(general)/+layout.svelte`, `src/routes/(private)/+layout.svelte`
- Error handling: `src/routes/+error.svelte`

---

## Development Preferences

### Code Style

- Use **TypeScript** for all new code
- Prefer **explicit types** over inference where it improves readability
- Use **semantic HTML** elements
- Follow existing **naming conventions** (PascalCase components, camelCase functions)

### Component Guidelines

- Keep components **focused and single-purpose**
- Use **Props interface** for component props
- Spread remaining props with `{...restProps}` for extensibility
- Use **local CSS variables** for theming/variants

### File Naming

- Components: `PascalCase.svelte`
- Utilities: `camelCase.ts`
- Types: `camelCase.ts` or `PascalCase.ts` for interfaces
- Routes: lowercase with hyphens

---

## Important Conventions

### CSS Class Naming

- Use `.host` class as the root element class name
- Use BEM-like modifiers with `--` separator (e.g., `fit--intrinsic`)
- Combine classes in arrays: `class={['host', 'button', modifierClass]}`

### State Management

- Use Svelte 5 **runes** for local state
- Service pattern for shared state (see `src/lib/services/`)

### Type Safety

- Define **Props interfaces** for all components
- Use **Omit** to extend HTML attributes while excluding `class`
- Leverage **svelte/elements** types

---

## Scripts

```bash
npm run dev          # Start dev server
npm run build        # Production build
npm run preview      # Preview production build
npm run check        # Run all checks (prettier, eslint, svelte-check)
npm run format       # Format with Prettier
npm run lint         # Lint check
```

---

## Deployment

- Deployed to **Netlify**
- Adapter: `@sveltejs/adapter-netlify`
- Config: `netlify.toml`
- Environment variables in `.env` (see `.env.example`)

---

## Supabase Workflow

### Type Generation

This project uses **Supabase-generated TypeScript types** religiously. After making database schema changes:

```bash
# If using local Supabase
supabase gen types typescript --local > src/lib/types/database.types.ts

# If using remote/production
supabase gen types typescript --project-id YOUR_PROJECT_ID > src/lib/types/database.types.ts
```

**IMPORTANT**: Regenerate types after ANY schema changes (new tables, columns, RLS policies, etc.)

### Database Management

Currently managed via:

- **Supabase Web Dashboard** - for schema changes, viewing data
- **Supabase CLI** - for type generation, migrations
- **Direct SQL** - for complex queries

### MCP Server Integration (Recommended Setup)

To enable Claude to help with database operations directly in chat sessions, install the Supabase MCP server:

1. Add to your MCP configuration (`.mcp.json` or Claude Desktop settings):

```json
{
	"mcpServers": {
		"supabase": {
			"command": "npx",
			"args": ["-y", "@modelcontextprotocol/server-supabase", "YOUR_SUPABASE_PROJECT_URL", "YOUR_SERVICE_ROLE_KEY"]
		}
	}
}
```

With this, Claude can:

- Run SQL queries directly
- View table schemas
- Create/modify tables
- Help with data operations
- All without leaving the chat session

**Other useful MCP servers for this project:**

- PostgreSQL MCP - Alternative database access
- GitHub MCP - PR/issue management
- See: https://github.com/modelcontextprotocol/servers

---

## Netlify Workflow

### CLI Setup

The Netlify CLI allows Claude to help with deployment tasks directly from chat sessions.

**Install:**

```bash
brew install netlify-cli
```

**Authenticate:**

```bash
netlify login
# Opens browser for authentication
netlify status
# Verify you're logged in
```

**Link to site:**

```bash
netlify link
# Choose existing site or create new one
```

**Common commands Claude can help with:**

- `netlify status` - Check deployment status and site info
- `netlify deploy` - Deploy to preview URL
- `netlify deploy --prod` - Deploy to production
- `netlify env:list` - List environment variables
- `netlify env:set KEY value` - Set environment variable
- `netlify open` - Open site admin in browser
- `netlify build` - Run build command locally

---

## Notes for Claude

- **Svelte 5 is new**: Always use runes syntax, not the old stores/reactive declarations
- **Component isolation**: Each component should be self-contained in its own directory
- **CSS-first approach**: Use design tokens and local variables instead of inline styles or utility classes
- **Type everything**: This project values type safety - use TypeScript features fully
- **Database types are critical**: Use Supabase-generated types for all database operations
- **Server/client separation**: Be mindful of where code runs (server vs client)
- When creating new components, follow the established patterns in existing components
- Check `system.tokens.css` for available design tokens before creating custom values
- The project uses Supabase SSR - be careful with auth in server vs client contexts
- **Political context**: This is a political party's main web presence - content and UX should reflect professionalism and trustworthiness
